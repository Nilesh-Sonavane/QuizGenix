<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" th:replace="~{base :: layout(~{::section}, 'Review Quiz')}">

<head></head>

<body>

    <section>
        <style>
            .review-header {
                background: #1e293b;
                border: 1px solid rgba(255, 255, 255, 0.1);
                border-radius: 16px;
                padding: 2rem;
                margin-bottom: 2rem;
                display: flex;
                align-items: center;
                justify-content: space-between;
                box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            }

            .rh-title h2 {
                margin: 0;
                font-size: 1.5rem;
                color: white;
            }

            .rh-meta {
                color: #94a3b8;
                font-size: 0.9rem;
                margin-top: 5px;
            }

            .score-badge {
                text-align: center;
                background: rgba(15, 23, 42, 0.6);
                padding: 10px 20px;
                border-radius: 12px;
                border: 1px solid rgba(255, 255, 255, 0.1);
            }

            .score-val {
                font-size: 1.8rem;
                font-weight: 800;
                color: #3b82f6;
                line-height: 1;
            }

            .score-lbl {
                font-size: 0.75rem;
                color: #64748b;
                text-transform: uppercase;
                letter-spacing: 1px;
            }

            /* Question Card */
            .q-card {
                background: #1e293b;
                border: 1px solid rgba(255, 255, 255, 0.05);
                border-radius: 16px;
                padding: 2rem;
                margin-bottom: 2rem;
                position: relative;
            }

            .q-num {
                font-size: 0.85rem;
                color: #64748b;
                text-transform: uppercase;
                letter-spacing: 1px;
                margin-bottom: 1rem;
                display: block;
            }

            .q-text {
                font-size: 1.25rem;
                color: white;
                margin-bottom: 1.5rem;
                font-weight: 500;
            }

            /* Options Logic */
            .opt-list {
                display: grid;
                gap: 10px;
            }

            .opt-item {
                padding: 12px 16px;
                border-radius: 8px;
                background: rgba(255, 255, 255, 0.03);
                border: 1px solid rgba(255, 255, 255, 0.1);
                color: #cbd5e1;
                display: flex;
                align-items: center;
                gap: 12px;
            }

            /* --- STATUS COLORS --- */
            /* 1. Correct Answer (Always Green) */
            .opt-item.correct {
                background: rgba(22, 163, 74, 0.15);
                border-color: #16a34a;
                color: white;
            }

            /* 2. User Wrong Selection (Red) */
            .opt-item.wrong {
                background: rgba(220, 38, 38, 0.15);
                border-color: #dc2626;
                color: white;
            }

            .marker {
                width: 24px;
                height: 24px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 0.8rem;
                font-weight: bold;
                flex-shrink: 0;
            }

            .correct .marker {
                background: #16a34a;
                color: white;
            }

            .wrong .marker {
                background: #dc2626;
                color: white;
            }

            .neutral .marker {
                background: rgba(255, 255, 255, 0.1);
                color: #94a3b8;
            }

            /* Explanation */
            .exp-box {
                margin-top: 1.5rem;
                background: rgba(59, 130, 246, 0.1);
                border-left: 3px solid #3b82f6;
                padding: 1rem;
                border-radius: 0 8px 8px 0;
            }

            .exp-head {
                color: #60a5fa;
                font-weight: 700;
                font-size: 0.9rem;
                margin-bottom: 5px;
                display: flex;
                gap: 8px;
                align-items: center;
            }

            .exp-body {
                color: #e2e8f0;
                font-size: 0.95rem;
                line-height: 1.5;
            }

            .back-btn {
                display: inline-block;
                margin-bottom: 20px;
                color: #94a3b8;
                text-decoration: none;
                font-weight: 600;
            }

            .back-btn:hover {
                color: white;
            }
        </style>

        <a href="/my-quizzes" class="back-btn">&larr; Back to My Quizzes</a>

        <div class="review-header">
            <div class="rh-title">
                <h2 th:text="${#strings.capitalizeWords(quiz.topic)}">Topic</h2>
                <div class="rh-meta">
                    <span th:text="${quiz.difficulty}">Medium</span> •
                    <span th:text="${#temporals.format(quiz.createdAt, 'dd MMM yyyy')}">Date</span>
                </div>
            </div>
            <div class="score-badge">
                <div class="score-val" th:text="${quiz.score} + '%'">80%</div>
                <div class="score-lbl">Score</div>
            </div>
        </div>

        <div th:each="question, iStat : ${quiz.questions}" class="q-card">

            <span class="q-num">Question <span th:text="${iStat.count}">1</span></span>
            <div class="q-text" th:text="${question.text}">What is Java?</div>

            <div class="opt-list">
                <div th:each="option, optStat : ${question.options}" th:with="
                        correctIdx=${question.correctAnswerIndex}, 
                        isCorrect=${optStat.index == correctIdx},
                        userSelected=${question.userAnswer != null and question.userAnswer.trim().equalsIgnoreCase(option.trim())},
                        statusClass=${isCorrect ? 'correct' : (userSelected ? 'wrong' : 'neutral')}
                     " class="opt-item" th:classappend="${statusClass}">

                    <div class="marker">
                        <span th:if="${isCorrect}">✓</span>
                        <span th:if="${userSelected and !isCorrect}">✕</span>
                        <span th:if="${!isCorrect and !(userSelected and !isCorrect)}"
                            th:text="${optStat.index == 0?'A':(optStat.index==1?'B':(optStat.index==2?'C':'D'))}">A</span>
                    </div>

                    <div th:text="${option}">Option Text</div>

                    <span th:if="${isCorrect}"
                        style="margin-left:auto; font-size:0.75rem; font-weight:700; color:#4ade80;">CORRECT</span>
                    <span th:if="${userSelected and !isCorrect}"
                        style="margin-left:auto; font-size:0.75rem; font-weight:700; color:#f87171;">YOUR ANSWER</span>
                </div>
            </div>

            <div class="exp-box">
                <div class="exp-head">
                    <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    Explanation
                </div>
                <div class="exp-body" th:text="${question.explanation}">
                    Because Java uses a virtual machine...
                </div>
            </div>

        </div>

    </section>

</body>

</html>